---
title: "Analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("multcomp")
#install.packages("car")

library(ggplot2)
library(data.table)
library(dplyr)
library(multcomp)
library(car)

dt <- fread('../../gen/analysis/temp/preclean.csv')
```

### Summary statistics

```{r}
dt$event <- as.factor(dt$event)
dt$travisscott <- as.factor(dt$travisscott)
dt$fortnite <- as.factor(dt$fortnite)
dt$astronomical  <- as.factor(dt$astronomical)
summary(dt)
```
### Data selection

1. Due to the limitation of the sentiment analysis, only tweets in English are analyzed. 
2. Retweets are excluded. 
3. Since the text in this dataset come from Twitter, Valence Aware Dictionary for sEntiment Reasoner (VADER) is used to to classify the sentiments expressed in Twitter data. The tweets with zero compound score are excluded. (could you think of any jusitifcation?)

```{r}
dt_analysis <- dt %>%
  filter(language == "en") %>%
  filter(retweet == "FALSE") %>%
  filter(compound != 0)

summary(dt_analysis)

```



### Plots

```{r}
x <- dt_analysis$compound
h<-hist(x, breaks=20, col="sky blue", xlab="Compound score",
   main="Histogram for tweets")
xfit<-seq(min(x),max(x),length=40)
yfit<-dnorm(xfit,mean=mean(x),sd=sd(x))
yfit <- yfit*diff(h$mids[1:2])*length(x)
lines(xfit, yfit, col="red", lwd=2)

```


```{r}  
dt_summary <- dt_analysis %>%
  group_by(event) %>%
  summarise(num_of_tweets = n(), avg_compound = mean(compound), SD = sd(compound),SE = sd(compound)/sqrt(length(compound)), 
    max = max(compound), min = min(compound), .groups = 'drop') %>%
  arrange(event)
dt_summary
```



```{r}
ggplot(dt_summary, aes(x = event,y = avg_compound)) + 
  geom_bar(position=position_dodge(), stat="identity", fill="sky blue") +
  geom_errorbar(aes(ymin=avg_compound-SE, ymax=avg_compound+SE),
                  width=.2,                    # Width of the error bars
                  position=position_dodge(.9)) +
  ggtitle("Average compound score with standard error") +
  scale_y_continuous(name = "Compound Score") +
  scale_x_discrete(name ="Event") +
  theme_light()




```

### Travis Scott



```{r}

dt_travis <- dt_analysis %>%
  group_by(travisscott) %>%
  summarise(num_of_tweets = n(), avg_compound = mean(compound), SD = sd(compound),SE = sd(compound)/sqrt(length(compound)), 
    max =  max(compound), min = min(compound), .groups = 'drop') %>%
  arrange(travisscott)

dt_travis 
```


```{r}
ggplot(dt_travis, aes(x = travisscott,y = avg_compound)) + 
  geom_bar(position=position_dodge(), stat="identity", fill="light green") +
  geom_errorbar(aes(ymin=avg_compound-SE, ymax=avg_compound+SE),
                  width=.2,                    # Width of the error bars
                  position=position_dodge(.9)) +
  ggtitle("Average compound score with standard error") +
  scale_y_continuous(name = "Compound Score") +
  scale_x_discrete(name ="Count of \"Travis Scott\" in a tweet") +
  theme_light() 



```





